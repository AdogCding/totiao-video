<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>今日头条视频下载工具</title>
    <link rel="stylesheet" href="index.css"/>
</head>
<body>
<h1>今日头条视频下载工具</h1>
<div>
    <div class="form-item">
        <label for="toutiao-pc-url-input">
            视频地址
        </label><input type="text" id="toutiao-pc-url-input" name="toutiao-pc-url-input">
        <button id="toutiao-pc-url-sure-button">确定</button>
    </div>
    <div class="form-item">
        <label for="toutiao-video-download-location">
            下载到
        </label><input type="text" id="toutiao-video-download-location" aria-readonly="true" name="toutiao-video-download-location" readonly>
        <button id="toutiao-video-download-location-choose-button">选择目录</button>
        <button id="toutiao-video-download-location-confirm-button">确定</button>
    </div>
</div>
<div class="overlay-default" id="mask">
    <div>系统工作中，请稍后</div>
</div>
</body>
<script src="render.js"></script>
<script type="text/javascript">
    const pcRow = {
        button: document.getElementById('toutiao-pc-url-sure-button'),
        input: document.getElementById('toutiao-pc-url-input')
    }
    const {button: pcButton, input: pcInput} = pcRow
    const chooseBtn = document.getElementById('toutiao-video-download-location-choose-button')
    const locationRow = {
        button: document.getElementById('toutiao-video-download-location-confirm-button'),
        input: document.getElementById('toutiao-video-download-location')
    }
    const {button: locationConfirmButton, input: locationInput} = locationRow
    chooseBtn.addEventListener('click', async () => {
        locationInput.value = await chooseDirectory()
    })
    pcButton.addEventListener('click', () => {
        const url = pcInput.value
        if (!isToutiaoUrl(url)) {
            window.alert("请输入PC端今日头条视频地址")
            return
        }
        if (!locationInput.value) {
            window.alert("请选择视频的下载目录")
            return;
        }
        MaskUtils.maskOn()
        downloadVideoByPcUrl(pcInput.value).catch(err => {

        }).finally(() => {
            MaskUtils.maskOff()
        })
    })
    locationConfirmButton.addEventListener('click', async () => {
        const folderLocation = locationInput.value
        MaskUtils.maskOn()
        changeVideoDownloadDirectory(folderLocation).then(el => {
            // cannot use this directory for some reason
            if (!el) {
                locationInput.value = ''
                window.alert(`${folderLocation}无法作为下载目录`)
                return
            }
            window.alert(`已将${folderLocation}作为下载目录`)
        }).catch(err => {
            window.alert(`${folderLocation}无法作为下载目录:${err}`)
        }).finally(() => {
            MaskUtils.maskOff()
        })
    })
</script>
<style>
    .form-item {
        padding-bottom: 10px;
    }
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: gray;
        z-index: 1;
    }
    .overlay-default {
        display: none;
    }
</style>
</html>
